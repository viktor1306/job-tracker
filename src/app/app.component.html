<!-- src/app/app.component.html -->

<div *ngIf="session; else loginTemplate">

  <div class="container">

    <div class="header">
      <h1>Мій трекер вакансій</h1>
      <button (click)="signOut()" class="logout-btn">Вийти</button>
    </div>

    <app-statistics-dashboard [vacancies]="vacancies"></app-statistics-dashboard>

    <form (ngSubmit)="addVacancy()" class="add-form">
      <h2>Додати нову вакансію</h2>
      <div class="form-grid">
        <input type="text" [(ngModel)]="newVacancy.vacancy_title" name="vacancy_title" placeholder="Назва вакансії"
          required>
        <input type="url" [(ngModel)]="newVacancy.vacancy_url" name="vacancy_url" placeholder="URL вакансії" required>
        <select [(ngModel)]="newVacancy.platform" name="platform">
          <option value="Work.ua">Work.ua</option>
          <option value="robota.ua">robota.ua</option>
        </select>
        <input type="text" [(ngModel)]="newVacancy.salary" name="salary" placeholder="Зарплата">
        <input type="date" [(ngModel)]="newVacancy.date_applied" name="date_applied">
        <select [(ngModel)]="newVacancy.status" name="status">
          <option value="Подано">Подано</option>
          <option value="Співбесіда">Співбесіда</option>
          <option value="Тестове">Тестове</option>
          <option value="Офер">Офер</option>
          <option value="Відмова">Відмова</option>
        </select>
      </div>
      <button type="submit">Додати вакансію</button>
      <!-- src/app/app.component.html -->

    </form>

    <!-- Якщо НЕ йде завантаження, показуємо контент -->
    <div *ngIf="!isLoading; else loadingSpinner">

      <div class="table-controls">
        <div class="search-container">
          <input type="text" [(ngModel)]="searchTerm" (input)="applyFiltersAndSorting()"
            placeholder="Пошук за назвою вакансії...">
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th (click)="onSort('vacancy_title')" class="sortable">
              Назва вакансії
              <span *ngIf="sortColumn === 'vacancy_title'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
            </th>
            <th (click)="onSort('platform')" class="sortable">
              Платформа
              <span *ngIf="sortColumn === 'platform'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
            </th>
            <th (click)="onSort('date_applied')" class="sortable">
              Дата відгуку
              <span *ngIf="sortColumn === 'date_applied'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
            </th>
            <th>ЗП</th>
            <th (click)="onSort('status')" class="sortable">
              Статус
              <span *ngIf="sortColumn === 'status'">{{ sortDirection === 'asc' ? '▲' : '▼' }}</span>
            </th>
            <th>Дії</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let vacancy of filteredVacancies">
            <td data-label="Назва вакансії"><a [href]="vacancy.vacancy_url" target="_blank">{{ vacancy.vacancy_title
                }}</a>
            </td>
            <td data-label="Платформа">{{ vacancy.platform }}</td>
            <td data-label="Дата відгуку">{{ vacancy.date_applied }}</td>
            <td data-label="ЗП">{{ vacancy.salary }}</td>
            <td data-label="Статус">
              <select [ngModel]="vacancy.status" (ngModelChange)="updateStatus(vacancy.id, $event)"
                name="status-{{vacancy.id}}">
                <option value="Подано">Подано</option>
                <option value="Співбесіда">Співбесіда</option>
                <option value="Тестове">Тестове</option>
                <option value="Офер">Офер</option>
                <option value="Відмова">Відмова</option>
              </select>
            </td>
            <td data-label="Дії">
              <button (click)="deleteVacancy(vacancy.id)" class="delete-btn">Видалити</button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Показуємо цей блок, тільки якщо завантаження завершено І список порожній -->
      <div *ngIf="filteredVacancies.length === 0" class="empty-state">
        <p>Ви ще не додали жодної вакансії. Час це виправити!</p>
      </div>

    </div>

    <!-- Інакше, показуємо шаблон зі спіннером -->
    <ng-template #loadingSpinner>
      <div class="spinner-container">
        <div class="spinner"></div>
      </div>
    </ng-template>

  </div>

</div>

<!-- Інакше (сесії немає), показуємо шаблон для входу -->
<ng-template #loginTemplate>
  <app-login></app-login>
</ng-template>

<app-confirm-dialog></app-confirm-dialog>